"use strict";require("tracking");module.exports=()=>{const t=window.tracking,e=(()=>{const t=window?.navigator?.userAgent?.toLowerCase(),e=-1!==t.indexOf("micromessenger"),a=/(^|;\s)app\//.test(t);return e?"miniprogram"===window?.__wxjs_environment?"wxapp":"wxh5":a?"app":"browser"})();return{checkLuminance:a=>new Promise(((h,i)=>{if("wxapp"===e)try{wx.getImageInfo({src:a,success:async e=>{const i=wx?.createOffscreenCanvas({type:"2d",width:e.width,height:e.height}),n=i?.getContext("2d"),r=i?.createImage();await new Promise((t=>{r.src=a,r.onload=t})),n.drawImage(r,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),g=t.Image.grayscale(s?.data,e.width,e.height);let o=0;for(let t=0;t<g.length;t++)o+=g[t];o/=g.length,h({brightness:o,isGray:o<80,isBright:o>150})},fail:t=>{i(t)}})}catch(t){i(t)}else try{const e=new Image;e.src=a,e.onload=()=>{const a=document.createElement("canvas");a.width=e.width||e?.offsetWidth,a.height=e.height||e?.offsetHeight;const i=a.getContext("2d");i.drawImage(e,0,0,a.width,a.height);const n=t.Image.grayscale(i.getImageData(0,0,a.width,a.height)?.data,a.width,a.height);let r=0;for(let t=0;t<n.length;t++)r+=n[t];r/=n.length,h({brightness:r,isGray:r<80,isBright:r>150})},e.onerror=()=>{i(new Error("图片加载失败"))}}catch(t){i(t)}})),checkDim:t=>new Promise(((a,h)=>{if("wxapp"===e)wx.getImageInfo({src:t,success:async e=>{const h=wx?.createOffscreenCanvas({type:"2d",width:e.width,height:e.height}),i=h?.getContext("2d"),n=h?.createImage();await new Promise((e=>{n.src=t,n.onload=e})),i.drawImage(n,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height).data;let s=0;for(let t=0;t<r.length;t+=4){const e=(r[t]+r[t+1]+r[t+2])/3;if(t>0){s+=Math.abs(e-(r[t-4]+r[t-3]+r[t-2])/3)}}const g=s/(n.width*n.height);a({averageDiff:g,isClear:g>4})},fail:t=>{h(t)}});else try{const e=new Image;e.src=t,e.onload=()=>{const t=document.createElement("canvas");t.width=e.width||e?.offsetWidth,t.height=e.height||e?.offsetHeight;const h=t.getContext("2d");t.width=e.width,t.height=e.height,h.drawImage(e,0,0,e.width,e.height);const i=h.getImageData(0,0,e.width,e.height).data;let n=0;for(let t=0;t<i.length;t+=4){const e=(i[t]+i[t+1]+i[t+2])/3;if(t>0){n+=Math.abs(e-(i[t-4]+i[t-3]+i[t-2])/3)}}const r=n/(e.width*e.height);a({averageDiff:r,isClear:r>4})},e.onerror=()=>{h(new Error("图片加载失败"))}}catch(t){h(t)}}))}};
//# sourceMappingURL=index.js.map
