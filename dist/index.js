const e={grayscale:function(e,t,a,h){for(var i=new Uint8ClampedArray(h?e.length:e.length>>2),n=0,r=0,s=0;s<a;s++)for(var g=0;g<t;g++){var o=.299*e[r]+.587*e[r+1]+.114*e[r+2];i[n++]=o,h&&(i[n++]=o,i[n++]=o,i[n++]=e[r+3]),r+=4}return i}};var t=(()=>{const t=(()=>{const e=window?.navigator?.userAgent?.toLowerCase(),t=-1!==e.indexOf("micromessenger")||-1!==e.indexOf("wechat")||!!window.wx&&!window.Image,a=/(^|;\s)app\//.test(e);return t?"miniprogram"===window?.__wxjs_environment||window?.__wxAppCode__?"wxapp":"wxh5":a?"app":"browser"})();return{checkLuminance:a=>new Promise(((h,i)=>{if("wxapp"===t)try{wx.getImageInfo({src:a,success:async t=>{const i=wx?.createOffscreenCanvas({type:"2d",width:t.width,height:t.height}),n=i?.getContext("2d"),r=i?.createImage();await new Promise((e=>{r.src=a,r.onload=e})),n.drawImage(r,0,0,t.width,t.height);const s=n.getImageData(0,0,t.width,t.height),g=e.grayscale(s?.data,t.width,t.height);let o=0;for(let e=0;e<g.length;e++)o+=g[e];o/=g.length,h({brightness:o,isGray:o<80,isBright:o>150})},fail:e=>{i(e)}})}catch(e){i(e)}else try{const t=new Image;t.src=a,t.onload=()=>{const a=document.createElement("canvas");a.width=t.width||t?.offsetWidth,a.height=t.height||t?.offsetHeight;const i=a.getContext("2d");i.drawImage(t,0,0,a.width,a.height);const n=e.grayscale(i.getImageData(0,0,a.width,a.height)?.data,a.width,a.height);let r=0;for(let e=0;e<n.length;e++)r+=n[e];r/=n.length,h({brightness:r,isGray:r<80,isBright:r>150})},t.onerror=()=>{i(new Error("图片加载失败"))}}catch(e){i(e)}})),checkDim:e=>new Promise(((a,h)=>{if("wxapp"===t)wx.getImageInfo({src:e,success:async t=>{const h=wx?.createOffscreenCanvas({type:"2d",width:t.width,height:t.height}),i=h?.getContext("2d"),n=h?.createImage();await new Promise((t=>{n.src=e,n.onload=t})),i.drawImage(n,0,0,t.width,t.height);const r=i.getImageData(0,0,t.width,t.height).data;let s=0;for(let e=0;e<r.length;e+=4){const t=(r[e]+r[e+1]+r[e+2])/3;if(e>0){s+=Math.abs(t-(r[e-4]+r[e-3]+r[e-2])/3)}}const g=s/(n.width*n.height);a({averageDiff:g,isClear:g>4})},fail:e=>{h(e)}});else try{const t=new Image;t.src=e,t.onload=()=>{const e=document.createElement("canvas");e.width=t.width||t?.offsetWidth,e.height=t.height||t?.offsetHeight;const h=e.getContext("2d");e.width=t.width,e.height=t.height,h.drawImage(t,0,0,t.width,t.height);const i=h.getImageData(0,0,t.width,t.height).data;let n=0;for(let e=0;e<i.length;e+=4){const t=(i[e]+i[e+1]+i[e+2])/3;if(e>0){n+=Math.abs(t-(i[e-4]+i[e-3]+i[e-2])/3)}}const r=n/(t.width*t.height);a({averageDiff:r,isClear:r>4})},t.onerror=()=>{h(new Error("图片加载失败"))}}catch(e){h(e)}}))}})();export{t as default};
//# sourceMappingURL=index.js.map
